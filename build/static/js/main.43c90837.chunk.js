(this.webpackJsonpcodesync=this.webpackJsonpcodesync||[]).push([[0],{146:function(e,t){},151:function(e,t,n){},152:function(e,t,n){"use strict";n.r(t);var a=n(3),c=n.n(a),o=n(78),r=n.n(o),i=n(9),s=n(25),u=n(13),l=n(10),d=n(22),j=function(){return localStorage.getItem("token")||null},b=function(e,t,n,a){localStorage.setItem("token",e),localStorage.setItem("username",JSON.stringify(t)),localStorage.setItem("name",JSON.stringify(n)),localStorage.setItem("photoURL",JSON.stringify(a))},h=n(5),m=["component","setAuth","setAuthLoading","isDrawerOpen"];var O=function(e){var t=e.component,n=e.setAuth,a=e.setAuthLoading,c=e.isDrawerOpen,o=Object(d.a)(e,m);return Object(h.jsx)(u.b,Object(l.a)(Object(l.a)({},o),{},{render:function(e){return j()?Object(h.jsx)(t,Object(l.a)({setAuth:n,setAuthLoading:a,isDrawerOpen:c},e)):Object(h.jsx)(u.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},v=["component","setAuth","setAuthLoading","socket"];var p=function(e){var t=e.component,n=e.setAuth,a=e.setAuthLoading,c=e.socket,o=Object(d.a)(e,v);return Object(h.jsx)(u.b,Object(l.a)(Object(l.a)({},o),{},{render:function(e){return j()?Object(h.jsx)(u.a,{to:{pathname:"/"}}):Object(h.jsx)(t,Object(l.a)({setAuth:n,setAuthLoading:a,Socket:c},e))}}))},g=n(28),f=n.n(g),x=n(0),N=n(2),S=n(80),w=n(33),k=Object(S.a)({apiKey:"AIzaSyBquhnb8FEUzjwJywfS8Ifxf6m8LVjl9ag",authDomain:"codesync-ooad.firebaseapp.com",projectId:"codesync-ooad",storageBucket:"codesync-ooad.appspot.com",messagingSenderId:"616748410621",appId:"1:616748410621:web:c99f252643e7971b21c094",measurementId:"G-DB2QH1HJR0"}),A=Object(w.c)(k),y=new w.a;y.addScope("https://www.googleapis.com/auth/userinfo.profile");var C=function(){var e=Object(N.a)(Object(x.a)().mark((function e(){var t,n;return Object(x.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(w.d)(A,w.b);case 3:return e.next=5,Object(w.e)(A,y);case 5:return t=e.sent,n=t.user,e.t0=console,e.t1=n,e.next=11,n.getIdTokenResult(!0);case 11:return e.t2=e.sent,e.t0.log.call(e.t0,e.t1,e.t2),e.abrupt("return",{auth:!0,accessToken:n.accessToken,name:n.displayName,email:n.email,photo:n.photoURL});case 16:return e.prev=16,e.t3=e.catch(0),console.error(e.t3),e.abrupt("return",{auth:!1,accessToken:null,name:null,email:null,photo:null});case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),L=["setAuth","setAuthLoading","Socket"];n(112).config();var I=function(e){var t=e.setAuth,n=e.setAuthLoading,c=(e.Socket,Object(d.a)(e,L)),o=Object(a.useState)(!1),r=Object(i.a)(o,2),s=r[0],u=r[1],l=Object(a.useState)(null),j=Object(i.a)(l,2)[1];Object(a.useEffect)((function(){return function(){}}),[]);var m=Object(a.useCallback)((function(e){n(!e),t(e)}),[t,n]);return s?Object(h.jsx)(h.Fragment,{children:Object(h.jsx)("div",{className:"loadclass-new",children:Object(h.jsxs)("div",{className:"spinner-box",children:[Object(h.jsx)("div",{className:"configure-border-1",children:Object(h.jsx)("div",{className:"configure-core"})}),Object(h.jsx)("div",{className:"configure-border-2",children:Object(h.jsx)("div",{className:"configure-core"})})]})})}):Object(h.jsxs)("div",{children:[Object(h.jsx)("h3",{className:"brand-titl",children:"CodeSync"}),Object(h.jsx)("input",{type:"button",value:s?"Loading...":"LOGIN",onClick:function(){j(null),u(!0),C().then((function(e){if(!e.auth)throw new Error("Something went wrong. Please try again later.");delete e.auth,f.a.post("".concat("https://cs.api.gauthamdas.me","/login"),e).then((function(e){var t,n,a,o;u(!1),b(null===(t=e.data)||void 0===t?void 0:t.accessToken,null===(n=e.data)||void 0===n?void 0:n.email,null===(a=e.data)||void 0===a?void 0:a.name,null===(o=e.data)||void 0===o?void 0:o.photo),m(!0),c.history.push("/")})).catch((function(e){var t,n,a;u(!1),console.log(null===(t=e.response)||void 0===t?void 0:t.data),401===(null===(n=e.response)||void 0===n?void 0:n.status)?j(null===(a=e.response)||void 0===a?void 0:a.data.error):j("Something went wrong. Please try again later.")}))})).catch((function(e){var t,n,a;u(!1),console.log(null===(t=e.response)||void 0===t?void 0:t.data),401===(null===(n=e.response)||void 0===n?void 0:n.status)?j(null===(a=e.response)||void 0===a?void 0:a.data.error):j("Something went wrong. Please try again later.")}))},disabled:s})]})};var D=function(){return Object(h.jsx)("div",{children:"Home"})},R=(n(64),["toggleDrawer","auth","setAuth"]);var U=function(e){var t=e.toggleDrawer,n=e.auth;return e.setAuth,Object(d.a)(e,R),Object(h.jsx)(h.Fragment,{children:n&&Object(h.jsxs)("nav",{className:"navbar",children:[Object(h.jsx)("div",{className:"logo",children:"My App"}),Object(h.jsxs)("ul",{className:"nav-links",children:[Object(h.jsx)("li",{children:Object(h.jsx)(s.b,{to:"/",children:"Home"})}),Object(h.jsx)("li",{children:Object(h.jsx)(s.b,{to:"/",children:"About"})}),Object(h.jsx)("li",{children:Object(h.jsx)(s.b,{to:"/editor",children:"Editor"})}),window.location.pathname.toLowerCase().startsWith("/editor")&&Object(h.jsx)("div",{className:"menu-toggle",onClick:t,children:Object(h.jsx)("i",{className:"fa-solid fa-users-line"})})]})]})})},F=n(17),E=n(1),T=n(82),J=n(81),P=["isDrawerOpen","users"];var B=function(e){var t=e.isDrawerOpen,n=e.users;return Object(d.a)(e,P),Object(h.jsxs)("div",{className:"drawer ".concat(t?"open":""),children:[Object(h.jsx)("h2",{children:"Active Users"}),Object(h.jsx)("ul",{children:n.map((function(e,t){return Object(h.jsxs)("li",{children:[e.email," - ",e.lineNumber,":",e.column]},t)}))})]})},M=["isDrawerOpen"],H=n.n(J)()("".concat("https://cs.socket.gauthamdas.me","/?token=").concat(j()),{reconnection:!0,autoConnect:!1,transports:["websocket"]}),z=[{label:"JavaScript",value:"javascript"},{label:"Python",value:"python"},{label:"C++",value:"cpp"}];var G=function(e){var t=e.isDrawerOpen,n=(Object(d.a)(e,M),Object(a.useState)({python:"",javascript:"",cpp:""})),c=Object(i.a)(n,2),o=c[0],r=c[1],s=Object(a.useRef)(null),b=Object(a.useState)(""),m=Object(i.a)(b,2),O=m[0],v=m[1],p=Object(a.useState)(!1),g=Object(i.a)(p,2),x=g[0],N=g[1],S=Object(a.useState)([{roomCode:"123456",roomName:"test"}]),w=Object(i.a)(S,2),k=w[0],A=w[1],y=Object(a.useState)([]),C=Object(i.a)(y,2),L=C[0],I=C[1],D=Object(a.useRef)([]),R=Object(u.g)(),U=R.location.pathname.split("/")[2],J=Object(a.useRef)(null),P=Object(a.useState)(J.current),G=Object(i.a)(P,2),V=G[0],W=G[1],q=Object(a.useCallback)((function(){setTimeout((function(){H.connect()}),2e3)}),[]);Object(a.useEffect)((function(){if(U&&x)return H.connected||q(),H.io.on("close",(function(e,t){console.log("socket closed"),"transport close"===e&&q()})),null===H||void 0===H||H.on("authConnect",(function(){H.emit("joinRoom",{token:j(),roomCode:U})})),null===H||void 0===H||H.on("cursorUpdate",(function(e){var t=e.cursor,n=e.email,a=e.language,c=String(t).split(":")[0],o=String(t).split(":")[1];a===J.current&&I((function(e){return e.forEach((function(e){e.email===n&&(e.lineNumber=parseInt(c),e.column=parseInt(o))})),Object(F.a)(e)}))})),null===H||void 0===H||H.on("codeUpdate",(function(e){var t=e.code;e.language===J.current&&r((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(E.a)({},J.current,t))}))})),null===H||void 0===H||H.on("activeUsersUpdate",(function(e){var t=e.email,n=e.name,a=e.lineNumber,c=e.column,o=e.type;I((function(e){var r=e.length?parseInt(e[e.length-1].id)+1:1,i=e.find((function(e){return e.email===t}));return i&&"leave"===o?e.filter((function(e){return e.email!==t})).map((function(e,t){return Object(l.a)(Object(l.a)({},e),{},{id:t+1})})):i&&"join"===o?e.map((function(e){return e.email===t?Object(l.a)(Object(l.a)({},e),{},{email:t,name:n,lineNumber:a,column:c,id:e.id}):e})):i||"join"!==o?e:[].concat(Object(F.a)(e),[{email:t,name:n,lineNumber:a,column:c,id:r}])}))})),function(){H.disconnect({token:j()}),H.removeAllListeners(),H.io.removeAllListeners()}}),[x,U,q]),Object(a.useEffect)((function(){return 6!==(null===U||void 0===U?void 0:U.length)?("/editor"===R.location.pathname&&f.a.post("".concat("https://cs.api.gauthamdas.me","/room/getDetails"),{token:j()}).then((function(e){A(e.data)})).catch((function(e){console.log(e)})),void R.push("/editor")):(f.a.post("".concat("https://cs.api.gauthamdas.me","/room/join"),{token:j(),roomCode:U}).then((function(e){var t,n,a,c,o;N(!0),v(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.roomName),W(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.defaultLanguage),J.current=null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.defaultLanguage,r(null===e||void 0===e||null===(c=e.data)||void 0===c?void 0:c.data),I(null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.activeUsers)})).catch((function(e){console.log(e),R.push("/editor")})),function(){})}),[R,U]),Object(a.useEffect)((function(){if(s.current){var e=s.current,t=e.editor,n=e.monaco;t.deltaDecorations(D.current,[]);var a=K(t,n,L),c=t.deltaDecorations([],a);D.current=c}}),[L]);var K=function(e,t,n){return n.map((function(e,n){return{range:new t.Range(e.lineNumber,e.column,e.lineNumber,parseInt(e.column)+1),options:{inlineClassName:"color-".concat(e.id),stickiness:t.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore,hoverMessage:{value:"User: ".concat(e.name)}}}}))};return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(B,{isDrawerOpen:t,users:L}),Object(h.jsx)("div",{className:"editor",children:x?Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)("h2",{children:["Code Editor ",Object(h.jsxs)("small",{"aria-haspopup":"tree",children:["(",O,")"]})]}),Object(h.jsx)("div",{className:"language-dropdown",children:Object(h.jsx)("select",{value:V||"",onChange:function(e){J.current=e.target.value,W(e.target.value),f.a.post("".concat("https://cs.api.gauthamdas.me","/room/changeLanguage"),{token:j(),roomCode:U,language:e.target.value}).then((function(e){var t;r((function(){return Object(l.a)(Object(l.a)({},o),{},Object(E.a)({},J.current,e.data.code))})),I(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.activeUsers)})).catch((function(e){console.log(e)}))},children:z.map((function(e){return Object(h.jsx)("option",{value:e.value,children:e.label},e.value)}))})}),Object(h.jsx)(T.a,{height:"75vh",theme:"vs-dark",language:J.current,value:o[J.current],options:{fontSize:20,autoFocus:!0},onMount:function(e,t){s.current={editor:e,monaco:t},e.focus(),e.onDidChangeCursorPosition((function(e){H.emit("cursorUpdate",{roomCode:U,cursor:"".concat(e.position.lineNumber,":").concat(e.position.column),language:J.current})}))},onChange:function(e,t){t.changes[0].forceMoveMarkers||(H.emit("codeUpdate",{roomCode:U,language:J.current,code:e}),r((function(){return Object(l.a)(Object(l.a)({},o),{},Object(E.a)({},J.current,e))})))}})]}):Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)("div",{children:[Object(h.jsxs)("form",{onSubmit:function(e){e.preventDefault(),f.a.post("".concat("https://cs.api.gauthamdas.me","/room/create"),{token:j(),roomName:e.target.roomName.value,defaultLanguage:e.target.language.value}).then((function(e){R.push("/editor/".concat(e.data.roomCode))})).catch((function(e){console.log(e)}))},children:[Object(h.jsxs)("label",{children:["Room Name:",Object(h.jsx)("input",{type:"text",id:"roomName"})]}),Object(h.jsx)("br",{}),Object(h.jsxs)("label",{children:["Default language:",Object(h.jsx)("select",{defaultValue:z[0],id:"language",children:z.map((function(e){return Object(h.jsx)("option",{value:e.value,children:e.label},e.value)}))})]}),Object(h.jsx)("button",{type:"submit",children:"Submit"})]}),Object(h.jsx)("h1",{children:"Create Room"})]}),Object(h.jsx)("br",{}),Object(h.jsxs)("div",{children:[Object(h.jsx)("h1",{children:"Join Room"}),k.map((function(e,t){return Object(h.jsx)("h5",{onClick:function(){return R.push("/editor/".concat(e.roomCode))},children:e.roomName},t)}))]})]})})]})};n(151);var V=function(){var e=Object(a.useState)(!0),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(!1),r=Object(i.a)(o,2),l=r[0],d=r[1],m=Object(a.useState)(!0),v=Object(i.a)(m,2),g=v[0],x=v[1];return Object(a.useEffect)((function(){var e=j();if(e)return f.a.post("".concat("https://cs.api.gauthamdas.me","/verifyToken"),{token:e}).then((function(t){var n,a,o;b(e,null===(n=t.data)||void 0===n?void 0:n.email,null===(a=t.data)||void 0===a?void 0:a.name,null===(o=t.data)||void 0===o?void 0:o.photo),c(!1),d(!0)})).catch((function(e){var t;401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("name")),c(!1),d(!1)})),function(){}}),[]),n&&j()?Object(h.jsx)(h.Fragment,{children:Object(h.jsx)("div",{className:"loadclass-new",children:Object(h.jsxs)("div",{className:"spinner-box",children:[Object(h.jsx)("div",{className:"configure-border-1",children:Object(h.jsx)("div",{className:"configure-core"})}),Object(h.jsx)("div",{className:"configure-border-2",children:Object(h.jsx)("div",{className:"configure-core"})})]})})}):Object(h.jsx)("div",{className:"App",children:Object(h.jsx)(s.a,{children:Object(h.jsxs)("div",{children:[Object(h.jsx)(U,{auth:l,setAuth:d,setAuthLoading:c,toggleDrawer:function(){x(!g)}}),Object(h.jsx)("div",{className:"content",children:Object(h.jsxs)(u.d,{children:[Object(h.jsx)(O,{exact:!0,path:"/",component:D,setAuth:d,setAuthLoading:c}),Object(h.jsx)(p,{exact:!0,path:"/",component:I}),Object(h.jsx)(p,{path:"/login",component:I,setAuth:d,setAuthLoading:c}),Object(h.jsx)(O,{path:"/editor",component:G,setAuth:d,setAuthLoading:c,isDrawerOpen:g})]})})]})})})},W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,153)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),o(e),r(e)}))};r.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(V,{})}),document.getElementById("root")),W()},64:function(e,t,n){}},[[152,1,2]]]);
//# sourceMappingURL=main.43c90837.chunk.js.map