(this.webpackJsonpcodesync=this.webpackJsonpcodesync||[]).push([[0],{115:function(e,t,n){},216:function(e,t){},222:function(e,t,n){},223:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),o=n(42),r=n.n(o),s=n(14),i=n(47),l=n(25),u=n(20),d=n(39),j=function(){return localStorage.getItem("token")||null},b=function(e,t,n,c){localStorage.setItem("token",e),localStorage.setItem("username",JSON.stringify(t)),localStorage.setItem("name",JSON.stringify(n)),localStorage.setItem("photoURL",JSON.stringify(c))},m=n(2),h=["component","setAuth","setAuthLoading","isDrawerOpen","users","setUsers"];var O=function(e){var t=e.component,n=e.setAuth,c=e.setAuthLoading,a=e.isDrawerOpen,o=e.users,r=e.setUsers,s=Object(d.a)(e,h);return Object(m.jsx)(l.b,Object(u.a)(Object(u.a)({},s),{},{render:function(e){return j()?Object(m.jsx)(t,Object(u.a)({setAuth:n,setAuthLoading:c,isDrawerOpen:a,users:o,setUsers:r},e)):Object(m.jsx)(l.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},v=["component","setAuth","setAuthLoading","socket"];var p=function(e){var t=e.component,n=e.setAuth,c=e.setAuthLoading,a=e.socket,o=Object(d.a)(e,v);return Object(m.jsx)(l.b,Object(u.a)(Object(u.a)({},o),{},{render:function(e){return j()?Object(m.jsx)(l.a,{to:{pathname:"/"}}):Object(m.jsx)(t,Object(u.a)({setAuth:n,setAuthLoading:c,Socket:a},e))}}))},f=n(51),g=n.n(f),x=n(1),w=n(5),N=n(132),k=n(60),y=Object(N.a)({apiKey:"AIzaSyBquhnb8FEUzjwJywfS8Ifxf6m8LVjl9ag",authDomain:"codesync-ooad.firebaseapp.com",projectId:"codesync-ooad",storageBucket:"codesync-ooad.appspot.com",messagingSenderId:"616748410621",appId:"1:616748410621:web:c99f252643e7971b21c094",measurementId:"G-DB2QH1HJR0"}),S=Object(k.c)(y),C=new k.a;C.addScope("https://www.googleapis.com/auth/userinfo.profile");var A=function(){var e=Object(w.a)(Object(x.a)().mark((function e(){var t,n;return Object(x.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(k.d)(S,k.b);case 3:return e.next=5,Object(k.e)(S,C);case 5:return t=e.sent,n=t.user,e.t0=console,e.t1=n,e.next=11,n.getIdTokenResult(!0);case 11:return e.t2=e.sent,e.t0.log.call(e.t0,e.t1,e.t2),e.abrupt("return",{auth:!0,accessToken:n.accessToken,name:n.displayName,email:n.email,photo:n.photoURL});case 16:return e.prev=16,e.t3=e.catch(0),console.error(e.t3),e.abrupt("return",{auth:!1,accessToken:null,name:null,email:null,photo:null});case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),L=["setAuth","setAuthLoading","Socket"];n(182).config();var D=function(e){var t=e.setAuth,n=e.setAuthLoading,a=(e.Socket,Object(d.a)(e,L)),o=Object(c.useState)(!1),r=Object(s.a)(o,2),i=r[0],l=r[1],u=Object(c.useState)(null),j=Object(s.a)(u,2)[1];Object(c.useEffect)((function(){return function(){}}),[]);var h=Object(c.useCallback)((function(e){n(!e),t(e)}),[t,n]);return i?Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"loadclass-new",children:Object(m.jsxs)("div",{className:"spinner-box",children:[Object(m.jsx)("div",{className:"configure-border-1",children:Object(m.jsx)("div",{className:"configure-core"})}),Object(m.jsx)("div",{className:"configure-border-2",children:Object(m.jsx)("div",{className:"configure-core"})})]})})}):Object(m.jsxs)("div",{className:"login-container",children:[Object(m.jsx)("h3",{className:"brand-title",children:"CodeSync"}),Object(m.jsx)("input",{type:"button",value:i?"Loading...":"LOGIN",onClick:function(){j(null),l(!0),A().then((function(e){if(!e.auth)throw new Error("Something went wrong. Please try again later.");delete e.auth,g.a.post("".concat("https://cs.api.gauthamdas.com","/login"),e).then((function(e){var t,n,c,o;l(!1),b(null===(t=e.data)||void 0===t?void 0:t.accessToken,null===(n=e.data)||void 0===n?void 0:n.email,null===(c=e.data)||void 0===c?void 0:c.name,null===(o=e.data)||void 0===o?void 0:o.photo),h(!0),a.history.push("/")})).catch((function(e){var t,n,c;l(!1),console.log(null===(t=e.response)||void 0===t?void 0:t.data),401===(null===(n=e.response)||void 0===n?void 0:n.status)?j(null===(c=e.response)||void 0===c?void 0:c.data.error):j("Something went wrong. Please try again later.")}))})).catch((function(e){var t,n,c;l(!1),console.log(null===(t=e.response)||void 0===t?void 0:t.data),401===(null===(n=e.response)||void 0===n?void 0:n.status)?j(null===(c=e.response)||void 0===c?void 0:c.data.error):j("Something went wrong. Please try again later.")}))},disabled:i})]})};var I=function(){return Object(m.jsx)("div",{children:"Home"})},U=(n(115),n(274)),R=n(260),E=["toggleDrawer","auth","setAuth","users"];var F=function(e){var t=e.toggleDrawer,n=e.auth,c=(e.setAuth,e.users);return Object(d.a)(e,E),Object(m.jsx)(m.Fragment,{children:n&&Object(m.jsxs)("nav",{className:"navbar",children:[Object(m.jsx)("div",{className:"logo",children:"CODESYNC"}),Object(m.jsxs)("ul",{className:"nav-links",children:[Object(m.jsx)("li",{children:Object(m.jsx)(i.b,{to:"/",children:"Home"})}),Object(m.jsx)("li",{children:Object(m.jsx)(i.b,{to:"/editor",children:"Editor"})}),window.location.pathname.toLowerCase().startsWith("/editor")&&Object(m.jsx)("div",{className:"menu-toggle",onClick:t,children:Object(m.jsx)(U.a,{color:"secondary",badgeContent:c.length,children:Object(m.jsx)(R.a,{})})})]})]})})},T=n(19),J=n(3),B=n(140),P=n(138),H=n.n(P),M=["isDrawerOpen","users"];var G=function(e){var t=e.isDrawerOpen,n=e.users;return Object(d.a)(e,M),Object(m.jsxs)("div",{className:"drawer ".concat(t?"open":""),children:[Object(m.jsx)("h2",{children:"Active Users"}),Object(m.jsx)("ul",{children:n.map((function(e,t){return Object(m.jsxs)("div",{className:"user-list",children:[Object(m.jsx)("div",{children:Object(m.jsx)("img",{src:e.photo,alt:e.name,referrerPolicy:"no-referrer"})}),Object(m.jsx)("div",{children:Object(m.jsx)("span",{className:"user-name",children:e.name})})]},t)}))})]})},z=n(280),V=n(281),W=n(275),q=n(271),K=n(276),Q=n(269),Y=n(272),X=n(279),Z=n(284),$=n(285),_=n(286),ee=n(287),te=n(288),ne=n(289),ce=n(261),ae=n(262),oe=n(263),re=["isDrawerOpen","users","setUsers"],se=H()("".concat("https://cs.socket.gauthamdas.com","/?token=").concat(j()),{reconnection:!0,autoConnect:!1,transports:["websocket"]}),ie=[{label:"JavaScript",value:"javascript",ext:"js"},{label:"Python",value:"python",ext:"py"},{label:"C++",value:"cpp",ext:"cpp"}];var le=function(e){var t=e.isDrawerOpen,n=e.users,a=e.setUsers,o=(Object(d.a)(e,re),Object(c.useState)({python:"",javascript:"",cpp:""})),r=Object(s.a)(o,2),b=r[0],h=r[1],O=Object(c.useRef)(null),v=Object(c.useState)(1),p=Object(s.a)(v,2),f=p[0],x=p[1],w=Object(c.useState)(""),N=Object(s.a)(w,2),k=N[0],y=N[1],S=Object(c.useState)(!1),C=Object(s.a)(S,2),A=C[0],L=C[1],D=Object(c.useState)([]),I=Object(s.a)(D,2),U=I[0],R=I[1],E=Object(c.useRef)(null),F=Object(c.useState)(""),P=Object(s.a)(F,2),H=P[0],M=P[1],le=Object(c.useRef)([]),ue=Object(l.g)(),de=ue.location.pathname.split("/")[2],je=Object(c.useRef)(null),be=Object(c.useState)(je.current),me=Object(s.a)(be,2),he=me[0],Oe=me[1],ve=Object(c.useCallback)((function(){setTimeout((function(){se.connect()}),1e3)}),[]);Object(c.useEffect)((function(){if(de&&A)return se.connected||ve(),se.io.on("close",(function(e,t){console.log("socket closed"),x(0),"transport close"===e&&ve()})),null===se||void 0===se||se.on("disconnect",(function(){console.log("socket diconnected")})),se.io.on("disconnect",(function(e){console.log("socket disconnected 1"),x(0)})),null===se||void 0===se||se.on("authConnect",(function(){x(2),se.emit("joinRoom",{token:j(),roomCode:de})})),null===se||void 0===se||se.on("cursorUpdate",(function(e){var t=e.cursor,n=e.email,c=e.language,o=String(t).split(":")[0],r=String(t).split(":")[1];c===je.current&&a((function(e){return e.forEach((function(e){e.email===n&&(e.lineNumber=parseInt(o),e.column=parseInt(r))})),Object(T.a)(e)}))})),null===se||void 0===se||se.on("codeUpdate",(function(e){var t=e.code;e.language===je.current&&h((function(e){return Object(u.a)(Object(u.a)({},e),{},Object(J.a)({},je.current,t))}))})),null===se||void 0===se||se.on("activeUsersUpdate",(function(e){var t=e.email,n=e.name,c=e.lineNumber,o=e.column,r=e.type;a((function(e){var a=e.length?parseInt(e[e.length-1].id)+1:1,s=e.find((function(e){return e.email===t}));return s&&"leave"===r?e.filter((function(e){return e.email!==t})).map((function(e,t){return Object(u.a)(Object(u.a)({},e),{},{id:t+1})})):s&&"join"===r?e.map((function(e){return e.email===t?Object(u.a)(Object(u.a)({},e),{},{email:t,name:n,lineNumber:c,column:o,id:e.id}):e})):s||"join"!==r?e:[].concat(Object(T.a)(e),[{email:t,name:n,lineNumber:c,column:o,id:a}])}))})),function(){se.disconnect({token:j()}),se.removeAllListeners(),se.io.removeAllListeners(),window.removeEventListener("offline",(function(){})),window.removeEventListener("online",(function(){})),L(!1),a([])}}),[A,de,ve]),Object(c.useEffect)((function(){return 6!==(null===de||void 0===de?void 0:de.length)?("/editor"===ue.location.pathname&&g.a.post("".concat("https://cs.api.gauthamdas.com","/room/getDetails"),{token:j()}).then((function(e){R(e.data)})).catch((function(e){console.log(e)})),void ue.push("/editor")):(g.a.post("".concat("https://cs.api.gauthamdas.com","/room/join"),{token:j(),roomCode:de}).then((function(e){var t,n,c,o,r;L(!0),y(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.roomName),Oe(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.defaultLanguage),je.current=null===e||void 0===e||null===(c=e.data)||void 0===c?void 0:c.defaultLanguage,h(null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.data),a(null===e||void 0===e||null===(r=e.data)||void 0===r?void 0:r.activeUsers)})).catch((function(e){console.log(e),ue.push("/editor")})),function(){})}),[ue,de]),Object(c.useEffect)((function(){if(O.current){var e=O.current,t=e.editor,c=e.monaco;t.deltaDecorations(le.current,[]);var a=pe(t,c,n),o=t.deltaDecorations([],a);le.current=o}}),[n]);var pe=function(e,t,n){return n.filter((function(e){return e.email!==function(){var e=localStorage.getItem("username");return e?JSON.parse(e):null}()})).map((function(e,n){return{range:new t.Range(e.lineNumber,e.column,e.lineNumber,parseInt(e.column)+1),options:{className:"color-".concat(e.id),stickiness:t.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore,hoverMessage:{value:"User: ".concat(e.name)},minimap:{color:"#ff82048b",position:t.editor.MinimapPosition.Gutter}}}}))};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(G,{isDrawerOpen:t,users:n}),A?Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"editor",children:[Object(m.jsxs)("div",{className:"code-bar",children:[Object(m.jsx)("u",{children:Object(m.jsx)("h3",{children:k})}),Object(m.jsx)("div",{className:"language-dropdown",children:Object(m.jsx)("select",{value:he||"",onChange:function(e){je.current=e.target.value,Oe(e.target.value),g.a.post("".concat("https://cs.api.gauthamdas.com","/room/changeLanguage"),{token:j(),roomCode:de,language:e.target.value}).then((function(e){var t;h((function(){return Object(u.a)(Object(u.a)({},b),{},Object(J.a)({},je.current,e.data.code))})),a(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.activeUsers)})).catch((function(e){console.log(e)}))},children:ie.map((function(e){return Object(m.jsx)("option",{value:e.value,children:e.label},e.value)}))})}),Object(m.jsx)("div",{className:"copy-button",onClick:function(){navigator.clipboard.writeText(window.location.href)},children:Object(m.jsxs)("button",{className:"copy-btn",children:[Object(m.jsx)("i",{className:"fa-solid fa-users-line"}),"\xa0Copy"]})}),Object(m.jsxs)("div",{className:"upload-button",children:[Object(m.jsx)("input",{type:"file",id:"file",ref:E,onChange:function(e){var t=e.target.files[0],n=new FileReader;n.readAsText(t,"UTF-8"),n.onload=function(e){h((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(J.a)({},je.current,e.target.result))})),se.emit("codeUpdate",{roomCode:de,language:je.current,code:e.target.result})},n.onerror=function(e){console.log(e)}},style:{display:"none"}}),Object(m.jsx)("label",{htmlFor:"file",children:Object(m.jsxs)("button",{className:"btn",onClick:function(e){E.current.click()},children:[Object(m.jsx)("i",{className:"fa-solid fa-upload"}),"\xa0Upload"]})})]}),Object(m.jsx)("div",{className:"download-button",children:Object(m.jsxs)("button",{className:"btn",onClick:function(){!function(e,t,n){var c=document.createElement("a"),a=new Blob([e],{type:n});c.href=URL.createObjectURL(a),c.download="".concat(t),document.body.appendChild(c),c.click()}(b[je.current],"".concat(k,".").concat(ie.find((function(e){return e.value===je.current})).ext),"text/plain")},children:[Object(m.jsx)("i",{className:"fa-solid fa-download"}),"\xa0Download"]})}),Object(m.jsx)("div",{children:0===f?Object(m.jsx)(ce.a,{sx:{color:"#ff0000"}}):1===f?Object(m.jsx)(ae.a,{sx:{color:"#ffee00"}}):Object(m.jsx)(oe.a,{sx:{color:"#00ff00"}})})]}),Object(m.jsx)(B.a,{height:"75vh",theme:"vs-dark",language:je.current,value:b[je.current],options:{fontSize:20,autoFocus:!0},onMount:function(e,t){O.current={editor:e,monaco:t},e.focus(),e.onDidChangeCursorPosition((function(e){"modelChange"!==e.source&&se.emit("cursorUpdate",{roomCode:de,cursor:"".concat(e.position.lineNumber,":").concat(e.position.column),language:je.current})}))},onChange:function(e,t){t.changes[0].forceMoveMarkers||(se.emit("codeUpdate",{roomCode:de,language:je.current,code:e}),h((function(){return Object(u.a)(Object(u.a)({},b),{},Object(J.a)({},je.current,e))})))}})]})}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"editor-dash",children:[Object(m.jsxs)(z.a,{sx:{display:"flex",height:"90%",width:"50%",flexDirection:"column",color:"black",background:"white",padding:"20px 200px",border:"15px solid #1976d2",borderRadius:"30px"},children:[Object(m.jsx)(V.a,{variant:"h4",component:"h1",sx:{mt:2,mb:2},children:"Create Room"}),Object(m.jsx)(W.a,{sx:{mb:2},children:Object(m.jsx)(q.a,{id:"roomName",type:"text",label:"Room Name",variant:"outlined"})}),Object(m.jsxs)(W.a,{sx:{mb:2},children:[Object(m.jsx)(K.a,{id:"select-label",children:"Default language"}),Object(m.jsx)(Q.a,{id:"language",variant:"outlined",label:"Default language",defaultValue:ie[0].value,children:ie.map((function(e){return Object(m.jsx)(Y.a,{value:e.value,children:e.label},e.value)}))})]}),Object(m.jsx)(X.a,{variant:"contained",color:"primary",type:"button",onClick:function(){var e=document.getElementById("roomName").value,t=document.getElementById("language").nextElementSibling.value;console.log(e,t),g.a.post("".concat("https://cs.api.gauthamdas.com","/room/create"),{token:j(),roomName:e,defaultLanguage:t}).then((function(e){ue.push("/editor/".concat(e.data.roomCode))})).catch((function(e){console.log(e)}))},children:"Create Room"})]}),Object(m.jsx)("br",{}),Object(m.jsxs)(z.a,{sx:{display:"flex",height:"90%",width:"50%",flexDirection:"column",color:"black",background:"white",padding:"20px 100px",border:"15px solid #1976d2",borderRadius:"30px"},children:[Object(m.jsx)(V.a,{variant:"h4",component:"h1",sx:{mt:2,mb:2},children:"Join Room"}),Object(m.jsx)(W.a,{sx:{mb:2},children:Object(m.jsx)(q.a,{id:"roomCode",type:"text",value:de||H,variant:"outlined",label:"Room Code",onChange:function(e){return M(e.target.value)}})}),Object(m.jsx)(X.a,{variant:"contained",color:"primary",onClick:function(){ue.push("/editor/".concat(H))},children:"Join"}),Object(m.jsx)(Z.a,{sx:{maxHeight:300},children:Object(m.jsxs)($.a,{stickyHeader:!0,"aria-label":"sticky table",children:[Object(m.jsx)(_.a,{children:Object(m.jsxs)(ee.a,{children:[Object(m.jsx)(te.a,{children:"Room Name"}),Object(m.jsx)(te.a,{children:"Room Code"}),Object(m.jsx)(te.a,{})]})}),Object(m.jsx)(ne.a,{children:U.map((function(e,t){return Object(m.jsxs)(ee.a,{children:[Object(m.jsx)(te.a,{children:e.roomName}),Object(m.jsx)(te.a,{children:e.roomCode}),Object(m.jsx)(te.a,{children:Object(m.jsx)(i.b,{to:"/editor/".concat(e.roomCode),children:"Join"})})]},t)}))})]})})]})]})})]})};n(222);var ue=function(){var e=Object(c.useState)(!0),t=Object(s.a)(e,2),n=t[0],a=t[1],o=Object(c.useState)(!1),r=Object(s.a)(o,2),u=r[0],d=r[1],h=Object(c.useState)(!1),v=Object(s.a)(h,2),f=v[0],x=v[1],w=Object(c.useState)([]),N=Object(s.a)(w,2),k=N[0],y=N[1];return Object(c.useEffect)((function(){var e=j();if(e)return g.a.post("".concat("https://cs.api.gauthamdas.com","/verifyToken"),{token:e}).then((function(t){var n,c,o;b(e,null===(n=t.data)||void 0===n?void 0:n.email,null===(c=t.data)||void 0===c?void 0:c.name,null===(o=t.data)||void 0===o?void 0:o.photo),a(!1),d(!0)})).catch((function(e){var t;401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("name")),a(!1),d(!1)})),function(){}}),[]),n&&j()?Object(m.jsx)(m.Fragment,{children:Object(m.jsx)("div",{className:"loadclass-new",children:Object(m.jsxs)("div",{className:"spinner-box",children:[Object(m.jsx)("div",{className:"configure-border-1",children:Object(m.jsx)("div",{className:"configure-core"})}),Object(m.jsx)("div",{className:"configure-border-2",children:Object(m.jsx)("div",{className:"configure-core"})})]})})}):Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(i.a,{children:Object(m.jsxs)("div",{children:[Object(m.jsx)(F,{auth:u,setAuth:d,setAuthLoading:a,toggleDrawer:function(){x(!f)},users:k}),Object(m.jsx)("div",{className:"content",children:Object(m.jsxs)(l.d,{children:[Object(m.jsx)(O,{exact:!0,path:"/",component:I,setAuth:d,setAuthLoading:a}),Object(m.jsx)(p,{exact:!0,path:"/",component:D}),Object(m.jsx)(p,{path:"/login",component:D,setAuth:d,setAuthLoading:a}),Object(m.jsx)(O,{path:"/editor",component:le,setAuth:d,setAuthLoading:a,isDrawerOpen:f,users:k,setUsers:y})]})})]})})})},de=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,290)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),o(e),r(e)}))};r.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(ue,{})}),document.getElementById("root")),de()}},[[223,1,2]]]);
//# sourceMappingURL=main.e6094982.chunk.js.map